#!/bin/bash

DIR=$(dirname "$0")
WARG="$DIR/../warg.test"
rc=0

color_red="$(tput setaf 1)"
color_green="$(tput setaf 2)"
color_reset="$(tput sgr0)"

EXPECTED='Usage: warg.test [OPTION...]
Options:
  -I, --indent=NUM              indent NUM spaces; 0 implies compact formatting (default: 0)
  -i, --infile=FILE             read input from FILE; '\''-'\'' to read from stdin (default: -)
  -o, --outfile=FILE            write output to FILE; '\''-'\'' to write to stdout (default: -)
  -p, --prefix=STRING           prefix widget names with STRING
  -T, --this-is-a-really-absurdly-unnecessarily-long-flag-name
                                set all of the doinklets to max frobulation
  -v, --verbose                 turn on verbose logging
  -?, --help                    show this help message and exit'

if $WARG --help > "$0.out" 2> "$0.err"; then
  echo -n "$0: "
  if echo "$EXPECTED" | diff "$0.out" -; then
    echo -n "${color_green}PASS"
  else
    echo -n "${color_red}FAIL"
    rc=1
  fi
  echo "${color_reset}"
else
  rc=1
fi

exit $rc
